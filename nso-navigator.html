<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NSO Navigator ¬∑ BioSynCare Lab</title>
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/nso-navigator.css" />
    <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  </head>
  <body class="nso-body">
    <header class="nso-header">
      <div class="nso-header-content">
        <h1>NSO Navigator</h1>
        <p class="muted-text">Neurosensory Stimulation Ontology Browser</p>
      </div>
      <div class="nso-header-controls">
        <select id="ontology-selector" class="ontology-selector" title="Select an ontology to visualize">
          <optgroup label="‚îÅ‚îÅ‚îÅ Main Ontologies ‚îÅ‚îÅ‚îÅ">
            <option value="bsc-consolidated" data-description="Complete: 60+ classes across audio, visual, multimodal techniques and outcomes (evidence 0-5 scale)">
              NSO Consolidated v1.0
            </option>
            <option value="bsc-audio" data-description="6 audio techniques: binaural/monaural beats, isochronic, solfeggio (evidence 0.5-2.5)">
              Audio Techniques
            </option>
            <option value="bsc-visual" data-description="7 visual: flicker, color, entrainment, Ganzfeld (evidence 1.2-3.8, epilepsy warnings)">
              Visual Techniques
            </option>
            <option value="bsc-mixed" data-description="9 multimodal: audiovisual, vibroacoustic, VR, haptic (evidence 1.5-3.5)">
              Multimodal Techniques
            </option>
            <option value="bsc-outcomes" data-description="30+ outcomes: cognitive, emotional, physiological, behavioral with measurement standards" selected>
              Outcomes Taxonomy
            </option>
          </optgroup>
          <optgroup label="‚îÅ‚îÅ‚îÅ Core & Legacy ‚îÅ‚îÅ‚îÅ">
            <option value="bsc-owl" data-description="Core classes (Project, Session, Technique, Outcome) + 11 safety/evidence properties">
              BSC Core (OWL)
            </option>
            <option value="bsc-skos" data-description="SKOS concept schemes for neurosensory stimulation">
              BSC Core (SKOS)
            </option>
            <option value="sso-ontology" data-description="External: Sensory Stimulation Ontology (legacy)">
              SSO Ontology (legacy)
            </option>
            <option value="sso-extended" data-description="External: Extended SSO (legacy)">
              SSO Extended (legacy)
            </option>
            <option value="sso-initial" data-description="External: SSO with hierarchies (legacy)">
              SSO Initial (legacy)
            </option>
            <option value="sso-updated" data-description="External: Updated SSO (legacy)">
              SSO Updated (legacy)
            </option>
            <option value="onc-ontology" data-description="External: Neurosensory Care Ontology (legacy)">
              ONC Ontology (legacy)
            </option>
            <option value="onc-attachment" data-description="External: ONC with hierarchies (legacy)">
              ONC Attachment (legacy)
            </option>
            <option value="harmonicare-sso" data-description="External: HarmoniCare SSO variant (legacy)">
              HarmoniCare SSO (legacy)
            </option>
            <option value="harmonicare-sso-alt" data-description="External: HarmoniCare SSO alt (legacy)">
              HarmoniCare SSO Alt (legacy)
            </option>
          </optgroup>
        </select>
        <div id="ontology-description" class="ontology-description" style="font-size: 0.85em; color: #666; margin-top: 4px; max-width: 600px;"></div>
        <select id="layout-selector" class="layout-selector">
          <option value="cose">Force-Directed (COSE)</option>
          <option value="circle">Circle</option>
          <option value="concentric">Concentric</option>
          <option value="breadthfirst">Breadth-First Tree</option>
          <option value="grid">Grid</option>
          <option value="cose-bilkent">COSE-Bilkent (Compound)</option>
        </select>
        <button type="button" id="toggle-properties" class="ghost small">
          <span id="properties-toggle-text">Hide Properties</span>
        </button>
        <button type="button" id="toggle-filters" class="ghost small">üîç Semantic Filters</button>
        <button type="button" id="reset-view" class="ghost small">Reset View</button>
        <a href="index.html" class="ghost small" style="text-decoration: none; display: inline-block; line-height: 1">Back to Dashboard</a>
      </div>
    </header>

    <!-- Semantic Filters Panel -->
    <div id="semantic-filters" class="semantic-filters hidden">
      <div class="filters-header">
        <h3 style="margin: 0; color: #1e40af; font-size: 1em;">üîç Semantic Filters</h3>
        <button type="button" id="close-filters" class="ghost small" aria-label="Close filters">√ó</button>
      </div>

      <div class="filters-content">
        <!-- Evidence Level Filter -->
        <div class="filter-section">
          <label for="evidence-level-slider" style="font-weight: 600; color: #374151; display: block; margin-bottom: 0.5rem;">
            üìä Evidence Strength: <span id="evidence-level-value">0.0+</span>/5
          </label>
          <input type="range" id="evidence-level-slider" min="0" max="5" step="0.1" value="0" style="width: 100%;" />
          <div style="display: flex; justify-content: space-between; font-size: 0.75em; color: #6b7280; margin-top: 0.25rem;">
            <span>Anecdotal</span>
            <span>Low</span>
            <span>Moderate</span>
            <span>High</span>
          </div>
        </div>

        <!-- Safety Filter -->
        <div class="filter-section">
          <label style="font-weight: 600; color: #374151; display: block; margin-bottom: 0.5rem;">
            ‚ö†Ô∏è Safety Warnings
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
            <input type="checkbox" id="filter-serious-warnings" />
            <span>Hide techniques with SERIOUS warnings</span>
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.25rem;">
            <input type="checkbox" id="filter-safe-only" />
            <span>Show only techniques with no warnings</span>
          </label>
        </div>

        <!-- Modality Filter -->
        <div class="filter-section">
          <label style="font-weight: 600; color: #374151; display: block; margin-bottom: 0.5rem;">
            üéµ Technique Modality
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
            <input type="checkbox" id="filter-audio" checked />
            <span>Audio Techniques</span>
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.25rem;">
            <input type="checkbox" id="filter-visual" checked />
            <span>Visual Techniques</span>
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.25rem;">
            <input type="checkbox" id="filter-mixed" checked />
            <span>Multimodal Techniques</span>
          </label>
        </div>

        <!-- Outcome Type Filter -->
        <div class="filter-section">
          <label style="font-weight: 600; color: #374151; display: block; margin-bottom: 0.5rem;">
            üéØ Outcome Categories
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
            <input type="checkbox" id="filter-cognitive" checked />
            <span>Cognitive Outcomes</span>
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.25rem;">
            <input type="checkbox" id="filter-emotional" checked />
            <span>Emotional Outcomes</span>
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.25rem;">
            <input type="checkbox" id="filter-physiological" checked />
            <span>Physiological Outcomes</span>
          </label>
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-top: 0.25rem;">
            <input type="checkbox" id="filter-behavioral" checked />
            <span>Behavioral Outcomes</span>
          </label>
        </div>

        <!-- Filter Actions -->
        <div class="filter-actions" style="display: flex; gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
          <button type="button" id="apply-filters" class="primary small" style="flex: 1;">Apply Filters</button>
          <button type="button" id="reset-filters" class="ghost small" style="flex: 1;">Reset All</button>
        </div>

        <div id="filter-results" style="margin-top: 0.75rem; padding: 0.5rem; background: #f0f9ff; border-radius: 4px; font-size: 0.85em; color: #0c4a6e; display: none;">
          <strong>Results:</strong> <span id="filter-count">0</span> nodes match filters
        </div>
      </div>
    </div>

    <div class="nso-container">
      <aside id="uri-inspector" class="uri-inspector hidden">
        <div class="inspector-header">
          <h2 id="inspector-title">URI Inspector</h2>
          <button type="button" id="close-inspector" class="ghost small" aria-label="Close inspector">√ó</button>
        </div>

        <div class="inspector-content">
          <section class="inspector-section">
            <h3>URI</h3>
            <code id="inspector-uri" class="uri-display"></code>
          </section>

          <section class="inspector-section">
            <h3>Type</h3>
            <p id="inspector-type" class="type-badge"></p>
          </section>

          <section class="inspector-section">
            <h3>Label</h3>
            <p id="inspector-label"></p>
          </section>

          <section class="inspector-section">
            <h3>Definition</h3>
            <p id="inspector-definition" class="muted-text"></p>
          </section>

          <section class="inspector-section">
            <h3>Properties</h3>
            <dl id="inspector-properties" class="property-list"></dl>
          </section>

          <section class="inspector-section">
            <h3>Comments</h3>
            <div id="inspector-comments" class="comments-list"></div>
            <button type="button" id="add-comment-btn" class="ghost small">+ Add Comment</button>

            <form id="comment-form" class="comment-form hidden">
              <textarea
                id="comment-input"
                placeholder="Add your comment or annotation..."
                rows="3"
                required
              ></textarea>
              <div class="form-actions">
                <button type="submit" class="primary small">Save</button>
                <button type="button" id="cancel-comment" class="ghost small">Cancel</button>
              </div>
            </form>
          </section>
        </div>
      </aside>

      <main class="graph-container">
        <div id="cy-canvas" class="cy-canvas"></div>

        <div id="edge-filters" class="edge-filters hidden">
          <h4>Edge Visibility</h4>
          <div class="filter-group">
            <label class="filter-checkbox">
              <input type="checkbox" id="filter-subclass" checked />
              <span>Subclass/Hierarchy</span>
            </label>
            <label class="filter-checkbox">
              <input type="checkbox" id="filter-domain" checked />
              <span>Domain</span>
            </label>
            <label class="filter-checkbox">
              <input type="checkbox" id="filter-range" checked />
              <span>Range</span>
            </label>
            <label class="filter-checkbox">
              <input type="checkbox" id="filter-related" checked />
              <span>Related/Other</span>
            </label>
          </div>
        </div>

        <div class="graph-legend">
          <h4>Legend</h4>
          <div class="legend-items">
            <div class="legend-section">
              <strong>Nodes</strong>
              <div class="legend-item">
                <span class="legend-color" style="background: #38bdf8"></span>
                <span>Class</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #22d3ee"></span>
                <span>Concept</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #a78bfa"></span>
                <span>Object Property</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #fb923c"></span>
                <span>Data Property</span>
              </div>
            </div>
            <div class="legend-section">
              <strong>Edges</strong>
              <div class="legend-item">
                <span class="legend-arrow subclass"></span>
                <span>Subclass/Hierarchy</span>
              </div>
              <div class="legend-item">
                <span class="legend-arrow domain"></span>
                <span>Domain</span>
              </div>
              <div class="legend-item">
                <span class="legend-arrow range"></span>
                <span>Range</span>
              </div>
              <div class="legend-item">
                <span class="legend-arrow related"></span>
                <span>Related/Other</span>
              </div>
            </div>
          </div>
        </div>

        <div id="loading-indicator" class="loading-indicator">
          <p>Loading ontology...</p>
        </div>

        <div id="error-message" class="error-message hidden">
          <p id="error-text"></p>
        </div>
      </main>
    </div>

    <script type="module" src="scripts/nso-navigator.js"></script>
  </body>
</html>
