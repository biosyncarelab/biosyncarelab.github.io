@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix bsc:  <https://biosyncarelab.github.io/ont#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix bsh:  <https://biosyncarelab.github.io/shapes#> .

bsh:StructureDatasetShape a sh:NodeShape ;
  sh:targetClass bsc:StructureDataset ;
  sh:property [
    sh:path bsc:hasSequence ;
    sh:minCount 1 ;
    sh:node bsh:PermutationSequenceShape ;
    sh:message "A structure dataset must have at least one permutation sequence." ;
  ] .

bsh:PermutationSequenceShape a sh:NodeShape ;
  sh:targetClass bsc:PermutationSequence ;
  sh:property [
    sh:path bsc:orderDimension ;
    sh:datatype xsd:integer ;
    sh:minCount 1 ;
    sh:message "Permutation sequences need an orderDimension (number of elements)." ;
  ] ;
  sh:property [
    sh:path bsc:hasRow ;
    sh:minCount 2 ;
    sh:node bsh:SequenceRowShape ;
    sh:message "Permutation sequences should contain at least two rows." ;
  ] ;
  sh:property [
    sh:path bsc:loop ;
    sh:datatype xsd:boolean ;
    sh:message "Loop should be boolean when present." ;
  ] .

bsh:SequenceRowShape a sh:NodeShape ;
  sh:targetClass bsc:SequenceRow ;
  sh:property [
    sh:path bsc:rowIndex ;
    sh:datatype xsd:integer ;
    sh:minCount 1 ;
    sh:message "Row index must be an integer." ;
  ] ;
  sh:property [
    sh:path bsc:rowValues ;
    sh:datatype xsd:integer ;
    sh:minCount 1 ;
    sh:message "Row values should be integers (zero-based positions)." ;
  ] .

bsh:MartigliOscillationShape a sh:NodeShape ;
  sh:targetClass bsc:MartigliOscillation ;
  sh:property [
    sh:path bsc:waveform ;
    sh:minCount 1 ;
    sh:class bsc:Waveform ;
    sh:in ( bsc:SineWave bsc:TriangleWave bsc:SquareWave bsc:SawtoothWave bsc:BreathWave bsc:MartigliWave ) ;
    sh:message "Waveform must be provided (e.g., bsc:SineWave)." ;
  ] ;
  sh:property [
    sh:path bsc:startPeriod ;
    sh:datatype xsd:decimal ;
    sh:minCount 1 ;
    sh:minInclusive 0.1 ;
    sh:message "Start period (seconds) is required." ;
  ] ;
  sh:property [
    sh:path bsc:endPeriod ;
    sh:datatype xsd:decimal ;
    sh:minCount 1 ;
    sh:minInclusive 0.1 ;
    sh:message "End period (seconds) is required." ;
  ] ;
  sh:property [
    sh:path bsc:transitionDuration ;
    sh:datatype xsd:decimal ;
    sh:minCount 1 ;
    sh:minInclusive 0 ;
    sh:message "Transition duration (seconds) is required." ;
  ] ;
  sh:property [
    sh:path bsc:inhaleRatio ;
    sh:datatype xsd:decimal ;
    sh:minInclusive 0 ;
    sh:maxInclusive 1 ;
    sh:message "Inhale ratio should be a decimal between 0 and 1." ;
  ] ;
  sh:property [
    sh:path bsc:amplitude ;
    sh:datatype xsd:decimal ;
    sh:minInclusive 0 ;
    sh:maxInclusive 1.5 ;
    sh:message "Amplitude should be a decimal value." ;
  ] .

# Audio / Visual / Haptic tracks
bsh:AudioTrackShape a sh:NodeShape ;
  sh:targetClass bsc:AudioTrack ;
  sh:property [
    sh:path bsc:waveform ;
    sh:class bsc:Waveform ;
    sh:in ( bsc:SineWave bsc:TriangleWave bsc:SquareWave bsc:SawtoothWave bsc:BreathWave bsc:MartigliWave ) ;
    sh:message "Audio tracks should reference a waveform class (e.g., bsc:SineWave)." ;
  ] ;
  sh:property [
    sh:path bsc:gain ;
    sh:datatype xsd:decimal ;
    sh:message "Audio gain should be a decimal (0-1)." ;
  ] .

bsh:VisualTrackShape a sh:NodeShape ;
  sh:targetClass bsc:VisualTrack ;
  sh:property [
    sh:path bsc:opacity ;
    sh:datatype xsd:decimal ;
    sh:message "Visual opacity should be a decimal (0-1) when present." ;
  ] ;
  sh:property [
    sh:path bsc:scaleFactor ;
    sh:datatype xsd:decimal ;
    sh:message "Visual scale should be a decimal when present." ;
  ] .

bsh:HapticTrackShape a sh:NodeShape ;
  sh:targetClass bsc:HapticTrack ;
  sh:property [
    sh:path bsc:intensity ;
    sh:datatype xsd:decimal ;
    sh:message "Haptic intensity should be a decimal when present." ;
  ] ;
  sh:property [
    sh:path bsc:vibrationPattern ;
    sh:datatype xsd:string ;
    sh:message "Haptic tracks may specify a vibration pattern identifier." ;
  ] .

bsh:TrackShape a sh:NodeShape ;
  sh:targetClass bsc:Track ;
  sh:property [
    sh:path bsc:hasParameter ;
    sh:minCount 1 ;
    sh:node bsh:ParameterShape ;
    sh:message "Tracks must have at least one parameter." ;
  ] ;
  sh:property [
    sh:path bsc:usesSequence ;
    sh:message "Tracks may reference a permutation sequence for ordering/modulation." ;
  ] .

bsh:ParameterShape a sh:NodeShape ;
  sh:targetClass bsc:Parameter ;
  sh:property [
    sh:path bsc:parameterName ;
    sh:datatype xsd:string ;
    sh:minCount 1 ;
    sh:message "Parameter name is required." ;
  ] ;
  sh:property [
    sh:path bsc:baseValue ;
    sh:datatype xsd:decimal ;
    sh:message "Base value should be a decimal when present." ;
  ] ;
  sh:property [
    sh:path bsc:depth ;
    sh:datatype xsd:decimal ;
    sh:message "Depth should be a decimal when present." ;
  ] ;
  sh:property [
    sh:path bsc:modulator ;
    sh:message "Modulator should point to an oscillator or modulation source." ;
  ] .

# Session presets and timing
bsh:SessionPresetShape a sh:NodeShape ;
  sh:targetClass bsc:SessionPreset ;
  sh:property [
    sh:path bsc:hasTrack ;
    sh:minCount 1 ;
    sh:message "Session presets must include at least one track." ;
  ] .

bsh:TrackTimingShape a sh:NodeShape ;
  sh:targetClass bsc:Track ;
  sh:property [
    sh:path bsc:startTime ;
    sh:datatype xsd:decimal ;
    sh:message "startTime should be a decimal (seconds)." ;
  ] ;
  sh:property [
    sh:path bsc:endTime ;
    sh:datatype xsd:decimal ;
    sh:message "endTime should be a decimal (seconds)." ;
  ] ;
  sh:property [
    sh:path bsc:fadeIn ;
    sh:datatype xsd:decimal ;
    sh:message "fadeIn should be a decimal (seconds)." ;
  ] ;
  sh:property [
    sh:path bsc:fadeOut ;
    sh:datatype xsd:decimal ;
    sh:message "fadeOut should be a decimal (seconds)." ;
  ] .

# Binaural Beat Track shape
bsh:BinauralBeatTrackShape a sh:NodeShape ;
  sh:targetClass bsc:BinauralBeatTrack ;
  sh:property [
    sh:path bsc:carrierFrequency ;
    sh:datatype xsd:decimal ;
    sh:minCount 1 ;
    sh:message "Binaural tracks need a carrierFrequency (Hz)." ;
  ] ;
  sh:property [
    sh:path bsc:beatFrequency ;
    sh:datatype xsd:decimal ;
    sh:minCount 1 ;
    sh:message "Binaural tracks need a beatFrequency (Hz)." ;
  ] ;
  sh:property [
    sh:path bsc:waveform ;
    sh:message "Waveform should reference a waveform class (e.g., bsc:SineWave)." ;
  ] .
